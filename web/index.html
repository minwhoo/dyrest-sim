<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<script type="text/javascript">
    window.onload = function() {
        ws = new WebSocket("ws://localhost:8080/ws");

        ws.onmessage = function (evt) {
            var obj = JSON.parse(evt.data);
            switch (obj["Code"]) {
                case 0:
                    addNode(obj["Data"]);
                    break;
                case 1:
                    updateNodeStatus(obj["Data"]);
                    break;
            }
        };

        ws.onclose = function () {
            var myTextArea = document.getElementById("textarea1");
            myTextArea.value = myTextArea.value + "\n" + "Connection closed";
        };

    };
    function updateNodeStatus(data) {
        console.log(data);
        document.getElementById(data["Id"]+"-"+data["Chunk"]["Idx"]).innerHTML = data["Status"]
    }
    function addNode(data) {
            console.log(data);
            var newdiv = document.createElement("div");
            newdiv.setAttribute("class","#node-div");
            newdiv.setAttribute("id",data["Id"]);
            var avail = data["Availability"];
            for (var i = 0; i < avail.length; i++) {
                var newp = document.createElement("span");
                newp.appendChild(document.createTextNode(avail[i]));
                newp.setAttribute("id",data["Id"]+"-"+i);
                newdiv.appendChild(newp);
                newdiv.appendChild(document.createTextNode(" "));
            }
            document.body.appendChild(newdiv)
    }
    function initialize() {
        if (!ws) {
            return false;
        }
        ws.send("initialize");
    }
    function start() {
        if (!ws) {
            return false;
        }
        ws.send("start");
    }
</script>
<style>
    #node-div p {
        float: left
    }
</style>
<body>
<button onclick="initialize()">Initialize</button>
<button onclick="start()">Start!</button>
</body>
</html>